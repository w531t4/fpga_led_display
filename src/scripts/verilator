#!/usr/bin/env python3
# SPDX-FileCopyrightText: 2025 Aaron White <w531t4@gmail.com>
# SPDX-License-Identifier: MIT
import os
import sys
from pathlib import Path


def find_verilator() -> str:
    override = os.environ.get("VERILATOR_BIN")
    if override:
        return override
    repo_root = Path(__file__).resolve().parent.parent.parent
    candidate = repo_root / "oss-cad-suite" / "bin" / "verilator"
    if candidate.is_file() and os.access(candidate, os.X_OK):
        return str(candidate)
    return "verilator"


def main() -> None:
    verilator = find_verilator()
    if len(sys.argv) < 2:
        os.execvp(verilator, [])
    args = sys.argv[1:]
    # last = args[-1]
    # dedup = [arg for arg in args[:-1] if arg != last]
    # dedup.append(last)
    # print(f"{verilator}, {[verilator] + args[:-1]}")
    os.execvp(verilator, [verilator] + args[:-1])


if __name__ == "__main__":
    main()
